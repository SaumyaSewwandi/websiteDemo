<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Area | Category</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css//style.css" rel="stylesheet">
   
	<style>
	
	</style>
  </head>
  <body> 

    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Admin Kit </a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="index.php">Dashboard</a></li>
            <li class="active"><a href="add_category.html">Add Category</a></li>
            <li><a href="add_post.html">Add New Post</a></li>
            <li><a href="users.html">Users</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Welcome</a></li>
            <li><a href="logout.php">Logout</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <header id="header">
      <div class="container">
        <div class="row">
          <div class="col-md-10">
            <h1><span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Pages<small>Manage Site Pages</small></h1>
          </div>
          <div class="col-md-2">
            <div class="dropdown create">
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                Create Content
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li><a type="button" data-toggle="modal" data-target="#addCategory">Add Category</a></li>
				 <li><a type="button" data-toggle="modal" data-target="#addPost">Add Post</a></li>
              
              </ul>
            </div>
          </div>
        </div>
      </div>
    </header>

    <section id="breadcrumb">
      <div class="container">
        <ol class="breadcrumb">
          <li><a href="index.php">Dashboard</a></li>
          <li class="active">Add Category</li>
        </ol>
      </div>
    </section>

    <section id="main">
      <div class="container">
        <div class="row">
          <div class="col-md-3">
            <div class="list-group">
              <a href="index.php" class="list-group-item active main-color-bg">
                <span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Dashboard
              </a>
              <a href="add_category.html" class="list-group-item"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Add Category </a>
              <a href="add_post.html" class="list-group-item"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Add New Post </a>
              <a href="users.html" class="list-group-item"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Users </a>
            </div>

            
          </div>
          <div class="col-md-9">
            <!-- Website Overview -->
            <div class="panel panel-default">
              <div class="panel-heading main-color-bg">
                <h3 class="panel-title">Category</h3>
              </div>
              <div class="panel-body" >

						<table class="table table-striped table-hover">
						<tr>
						<th width="35%">Category id</th>
						<th width="35%">Category Name</th>
						<th width="45%">Action</th></tr>
						<tbody id = "category" >
                     
						<tbody>

						</table>
						
						
				
              </div> 
              </div>
			 
              </div>

          
        </div>
      </div>
    </section>

  

    <!-- Modals -->

    <!-- edit Page -->
   <div class="modal fade" id="addCategory" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

				 <form id = "insert_form">
				  <div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">Add Category</h4>
				  </div>
				  <div class="modal-body">
					<div class="form-group">
					  <label>Category</label>
					  <input type ="hidden" id="category_id" name ="id">
					  <input type="text" id="insert_name" name ="name" class="form-control"placeholder="New Category" >
					</div>
				   
				  <div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-info" name ="submit">Save changes</button>
				  </div>
				  </div>
				</form>
				
  </div>
  </div>
</div>
   <!-- Edit Page -->
   <div class="modal fade" id="Edit_category" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
     
				 <form id="Edit_form">
				  <div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">Edit Category</h4>
				  </div>
				  <div class="modal-body">
					<div class="form-group">
					  <label>Category</label>
					  <input type ="hidden" id="cid" name ="cid">
					  <input type="text" id="edit_name" name ="name" class="form-control"placeholder="New Category" >
					</div>
				   
				  <div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="submit" class="btn btn-info" name ="submit">Update</button>
				  </div>
				</form>
				</div>
  </div>
  </div>
</div>

  <footer id="footer">
      <p>Copyright Admin Kit, &copy; 2021</p>
  </footer>
	
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
 

     <script type="text/javascript">
	 
	
	$(document).ready(function(){
	
		 getdata();
		

		$('#insert_form').on ('submit', function(event){
				event.preventDefault();
			$.ajax({
                url: "http://localhost/cms/admin/category.php",
                method: "POST",
                dataType: "JSON",
				cache: false,
				data: $('#insert_form').serialize(),
                
                success: function (response) {
				
				if (response.status == 200) {
					$("#insert_form").trigger("reset");
					$("#addCategory").modal('hide');
				 	alert(response.message);
					$('#category').html('');
					 getdata();
				}
				else if(response.status == 403){
					alert(response.message);
				}
					
			
				}

			});

		
		});	
		
		$('#category').on ('click','.Edit', function(){
		
		
			var cid = $(this).data("id");
		
			$.ajax({
		
			url: "fetch.php",
                method: "POST",
				data: {cid:cid},
				dataType: "JSON",
				success: function (data) {
					$('#cid').val(data.id); 
                    $('#edit_name').val(data.name); 
					
										
					}
		
		
			});
		});
		
		$('#Edit_form').on('submit', function(event){
					event.preventDefault();

		var id = $('#cid').val();
		var name = $('#edit_name').val();
		
		
	
		$.ajax({
		
				url: "http://localhost/cms/admin/category.php?id="+id+"&name="+name,
                method: "PUT",
                dataType: "JSON",
				success: function (response) {
                   // console.log(response);
					$("#Edit_form").trigger("reset");
					$("#Edit_category").modal('hide');
					$('#category').html('');
					 getdata();
					}
		
		
			});
		
		});
		
		
	
	function getdata(){
		$.ajax({
                url: "http://localhost/cms/admin/category.php",
                method: "GET",
                dataType: 'JSON',
                cache: false,
                success: function (response) {
                    console.log(response);
            

                    response.forEach(function(row){
                        
                        /*$('#category').append('<table class="table table-striped table-hover"><tr><td data-id='+ row.id+'>'+row.name+'</td><td><a href="edit_Post.html" ><button data-id='+ row.id+' class="Edit" href="edit_Post.html">Edit</button></a></td><td><button data-id='+ row.id+' class="Delete">Delete</button></td></tr></table>'); //postContainer Div
						$('#category').append('<button data-id='+ row.id+' class="Delete">Delete</button>');*/
						
						$('#category').append('<tr><td>'+row.id+'</td><td>'+row.name+'</td><td><button data-id='+ row.id+'  class="Edit btn btn-primary" data-toggle="modal" data-target="#Edit_category"><span class="glyphicon  glyphicon-pencil"></span>Edit</button><span>  </span><button data-id='+ row.id+' class="Delete btn btn-danger"><span class="glyphicon glyphicon-trash"></span>Delete</button></td></tr>'); 
						/*$('#category').append('<button data-id='+ row.id+' class="Delete">Delete</button>');*/
					
						
                    });
                },

                
                error: function(response) {

                }
            });
		
}

		
	$(document.body).on('click','.Delete', function(event){
					event.preventDefault();	
					
			var id = $(this).data('id');
		
	if(confirm("Are you sure you want to remove this category from database?"))
			{
		   $.ajax({
			url:"http://localhost/cms/admin/category.php?id="+id,
			method:"DELETE",
			dataType: "JSON",

			success:function(response)
			{
			
						if (response.status == 200) {
							
							alert(response.message);
							$('#category').html('');
							getdata();
						}else if(response.status == 303){
							alert(response.message);
						}
			}
		   })
		  }
		  else
		  {
		   alert('Cancelled');
		  }
				
			
		});		 
		
});	
 
 </script>  
   

    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
 


  
  </body>
</html>
